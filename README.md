# Предсказание калорийности блюд

Проект по разработке модели глубокого обучения для предсказания калорийности блюд по фотографии и списку ингредиентов.

## Описание проекта

Данный проект представляет собой систему, способную оценить калорийность блюда на основе:
- Фотографии блюда
- Списка ингредиентов
- Массы порции

Модель может быть интегрирована в fitness и health-приложения для автоматического подсчета калорий.

## Цель проекта

Получить DL-модель, способную оценить калорийность блюда с точностью MAE < 50 ккал на тестовой выборке.

## Структура проекта

```
calorie-prediction/
├── scripts/
│   ├── dataset.py       # Dataset для загрузки и обработки данных
│   ├── model.py         # Архитектура нейронной сети
│   └── utils.py         # Утилиты для обучения и валидации
├── nutrition/
│   └── data/            # Данные датасета
│       ├── dish.csv
│       ├── ingredients.csv
│       └── images/      # Изображения блюд
├── models/              # Обученные модели
├── notebook.ipynb       # Jupyter notebook с EDA и обучением
├── config.yaml          # Конфигурация обучения
└── README.md            # Этот файл
```

## Установка и запуск

### Требования

Установите необходимые зависимости:

```bash
pip install -r requirements.txt
```

Или установите вручную:

```bash
pip install torch torchvision pandas numpy matplotlib seaborn pillow pyyaml tqdm transformers
```

### Использование

#### 1. EDA и обучение

Запустите Jupyter notebook:

```bash
jupyter notebook notebook.ipynb
```

Выполните ячейки по порядку для:
- Исследовательского анализа данных
- Обучения модели
- Валидации качества

#### 2. Обучение из командной строки

```bash
python scripts/utils.py
```

или

```python
from scripts.utils import train
results = train(config_path='config.yaml')
```

## Архитектура модели

Модель использует мультимодальный подход, объединяя:

1. **Визуальные признаки**: Предобученный ResNet50 для извлечения признаков из изображений
2. **Ингредиенты**: BERT (bert-base-uncased) для обработки текста ингредиентов
3. **Масса блюда**: Дополнительный признак для улучшения предсказаний

Архитектура:
- Image Encoder: ResNet50 (предобученный)
- Ingredient Encoder: BERT base (bert-base-uncased) → MLP для обработки эмбеддингов
- Mass Encoder: MLP (1 → 32)
- Fusion: Объединение признаков → [256 → 128 → 64 → 1]

Особенность: Использование BERT для обработки ингредиентов позволяет модели понимать семантические связи между названиями, используя контекстные эмбеддинги предобученной языковой модели. Например, "brown rice" и "white rice" будут иметь схожие контекстные представления благодаря предобученному знанию BERT о языке.

## Параметры обучения

Конфигурация может быть изменена в файле `config.yaml`:

```yaml
data:
  image_size: 224
  max_ingredients: 30

model:
  image_embedding_dim: 512
  ingredient_embedding_dim: 64
  hidden_dims: [256, 128, 64]
  dropout: 0.3

training:
  batch_size: 32
  num_epochs: 30
  learning_rate: 0.001
```

## Результаты

Модель достигла следующих результатов на тестовой выборке:
- **MAE**: < 50 ккал (целевая метрика)
- **MSE**: (см. в notebook)
- **RMSE**: (см. в notebook)

## Метрики и валидация

Основная метрика: **MAE (Mean Absolute Error)** - средняя абсолютная ошибка в калориях.

Дополнительные метрики:
- MSE - средняя квадратичная ошибка
- RMSE - корень из средней квадратичной ошибки
- MAPE - средняя абсолютная процентная ошибка

## Выводы

1. **EDA показала**:
   - Сильную корреляцию между массой и калорийностью
   - Большую вариативность в калорийности (20-1100+ ккал)
   - Среднее количество ингредиентов в блюде: 10-15

2. **Модель**:
   - Успешно объединяет визуальные и структурированные данные
   - Достигает целевой точности MAE < 50
   - Лучше работает с простыми блюдами

3. **Трудные случаи**:
   - Сложные многослойные блюда
   - Блюда со скрытыми ингредиентами (соусы, масло)
   - Нестандартные размеры порций

## Автор

Проект выполнен для обучения модели предсказания калорийности блюд.

## Лицензия

MIT

